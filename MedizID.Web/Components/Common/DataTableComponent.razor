@* Reusable data table component with pagination and filtering *@
@typeparam TItem
@inject ISnackbar Snackbar

<MudCard>
    <MudCardContent>
        @if (Loading)
        {
            <MudProgressCircular Indeterminate="true" />
        }
        else if (Items == null || Items.Count == 0)
        {
            <MudText Color="Color.Default" Align="Align.Center" Class="py-8">
                No records found
            </MudText>
        }
        else
        {
            <MudTable Items="@Items" 
                      Hover="true" 
                      Striped="true" 
                      FixedHeader="true" 
                      Height="400px"
                      CurrentPage="@(CurrentPage - 1)" 
                      RowsPerPage="@PageSize"
                      OnPageIndexChanged="@((int page) => HandlePageChanged(page))"
                      @ref="mudTable">
                <ToolBarContent>
                    <MudText Typo="Typo.h6">@Title</MudText>
                    <MudSpacer />
                    @if (CanCreate)
                    {
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="@(async () => await OnCreate.InvokeAsync())">
                            Add New
                        </MudButton>
                    }
                </ToolBarContent>
                <HeaderContent>
                    @HeaderContent
                </HeaderContent>
                <RowTemplate>
                    @if (RowTemplate != null)
                    {
                        @RowTemplate(context)
                    }
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="@(new int[]{5, 10, 25, 50})" />
                </PagerContent>
            </MudTable>
        }
    </MudCardContent>
</MudCard>

@code {
    [Parameter]
    public string Title { get; set; } = "Data";
    
    [Parameter]
    public List<TItem> Items { get; set; } = new();
    
    [Parameter]
    public int Total { get; set; } = 0;
    
    [Parameter]
    public int CurrentPage { get; set; } = 1;
    
    [Parameter]
    public int PageSize { get; set; } = 10;
    
    [Parameter]
    public bool Loading { get; set; } = false;
    
    [Parameter]
    public bool CanCreate { get; set; } = true;
    
    [Parameter]
    public EventCallback OnCreate { get; set; }
    
    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }
    
    [Parameter]
    public RenderFragment<TItem>? RowTemplate { get; set; }
    
    [Parameter]
    public RenderFragment? HeaderContent { get; set; }
    
    private MudTable<TItem>? mudTable;
    
    private async Task HandlePageChanged(int pageIndex)
    {
        await OnPageChanged.InvokeAsync(pageIndex + 1);
    }
}