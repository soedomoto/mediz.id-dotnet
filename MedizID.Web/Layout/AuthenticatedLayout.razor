@inherits LayoutComponentBase
@inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager

<Layout Style="min-height: 100vh;">
    @* <Sider Collapsible="true">
        <Menu Mode="MenuMode.Inline" DefaultSelectedKeys="@(new List<string> { "1" })">
            <MenuItem Key="1">
            <TablerSvgIcon Icon="TablerSvgIcon.Home" Width="14" Height="14" />
            <NavLink href="/dashboard">Dashboard</NavLink>
            </MenuItem>
            <MenuItem Key="2">
            <TablerSvgIcon Icon="TablerSvgIcon.User" Width="14" Height="14" />
            <NavLink href="/patients">Patients</NavLink>
            </MenuItem>
            <MenuItem Key="3">
            <TablerSvgIcon Icon="TablerSvgIcon.FileText" Width="14" Height="14" />
            <NavLink href="/medical-records">Medical Records</NavLink>
            </MenuItem>
            <MenuItem Key="4">
            <TablerSvgIcon Icon="TablerSvgIcon.Calendar" Width="14" Height="14" />
            <NavLink href="/appointments">Appointments</NavLink>
            </MenuItem>
            <MenuItem Key="5">
            <TablerSvgIcon Icon="TablerSvgIcon.Settings" Width="14" Height="14" />
            <NavLink href="/settings">Settings</NavLink>
            </MenuItem>
        </Menu>
    </Sider> *@
    <Layout>
        <Header
            Style="background: white; padding: 0 24px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="color: #1890ff; font-size: 18px; font-weight: bold;">MedizID</div>
            <Space>
                <SpaceItem>
                    <span>Welcome, @(userName ?? "User")</span>
                </SpaceItem>
                <SpaceItem>
                    <Button Type="ButtonType.Primary" Danger Size="ButtonSize.Small" @onclick="Logout">Logout</Button>
                </SpaceItem>
            </Space>
        </Header>
        <Content Style="padding: 24px; background: #f5f5f5;">
            @Body
        </Content>
        <Footer Style="text-align: center;">
            MedizID Â©2025 Indonesian Clinic Management and Electronic Medical Record System
        </Footer>
    </Layout>
</Layout>

@code {
    private string? userName;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            string? userJson = await LocalStorage.GetItemAsync<string>("user");
            LoginResponse? user = userJson is not null ? System.Text.Json.JsonSerializer.Deserialize<LoginResponse>(userJson) : null;
            userName = user?.FirstName + " " + user?.LastName;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading user info: {ex.Message}");
        }
    }

    private async Task Logout()
    {
        try
        {
            await LocalStorage.RemoveItemAsync("authToken");
            await LocalStorage.RemoveItemAsync("userId");
            NavigationManager.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error during logout: {ex.Message}");
        }
    }
}